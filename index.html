// --- Singleton Pattern Implementation ---
const AppConfig = (function() {
    let instance;

    function createInstance() {
        // Private configuration object
        const config = {
            currency: 'USD',
            currencySymbol: '$',
            taxRate: 8.5,
            deliveryFee: 2.99,
            discountPercentage: 10,
        };
        
        // Private unique instance ID for demonstration
        const instanceId = Math.random().toString(36).substring(2, 11);
        const createdAt = new Date();

        // Public API for the singleton instance
        return {
            updateCurrency(currency) {
                const symbols = { USD: '$', EUR: '€', GBP: '£', INR: '₹' };
                config.currency = currency;
                config.currencySymbol = symbols[currency] || '$';
            },
            updateTaxRate(rate) {
                config.taxRate = parseFloat(rate);
            },
            updateDeliveryFee(fee) {
                config.deliveryFee = parseFloat(fee);
            },
            updateDiscount(percentage) {
                config.discountPercentage = parseFloat(percentage);
            },
            formatCurrency(amount) {
                return `${config.currencySymbol}${parseFloat(amount).toFixed(2)}`;
            },
            calculateTotal(itemPrice, quantity) {
                const subtotal = itemPrice * quantity;
                const discount = subtotal * (config.discountPercentage / 100);
                const discountedSubtotal = subtotal - discount;
                const tax = discountedSubtotal * (config.taxRate / 100);
                const total = discountedSubtotal + tax + config.deliveryFee;
                
                return { subtotal, discount, discountedSubtotal, tax, deliveryFee: config.deliveryFee, total };
            },
            // Expose necessary config and info for display
            getInstanceInfo: () => ({
                id: instanceId,
                createdAt: createdAt,
                config: { ...config }
            })
        };
    }

    // The public method to get the single instance
    return {
        getInstance: function() {
            if (!instance) {
                instance = createInstance();
                console.log(`AppConfig singleton created with ID: ${instance.getInstanceInfo().id}`);
            }
            return instance;
        }
    };
})();
